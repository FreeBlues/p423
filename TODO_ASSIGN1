

P423 COMPILER: Assignment1 Framework:
-------------------------------------

TODO

 * First, read the assignment description.
   
 * In this assignment you will populate the ./compiler/ directory with
   one or more source files.

 * At least one of those source files must be ./compiler/compiler.ss.
   This is the main entry point into your compiler and must satisfy
   certain constraints for us to be able to execute your compiler.

    - It must define a library named (compiler compile)
    - That library must export p423-compile and p423-compile-passes

    - You may be unfamiliar with the R6RS system for defining scheme
      *libraries* (separate compilation units).  For this first
      assignment we provide example code for compile.ss, which follows
      below.  It assumes you have defined two additional files, each 
      containing one pass:

      * compiler/verify-scheme.ss
      * compiler/generate-x86-64.ss

(library (compiler compile)
  (export p423-compile p423-compile-passes)
  (import ;; Load Chez Scheme primitives:
          (chezscheme)
          ;; Load provided compiler framework:
          (framework driver)
          (framework wrappers)
          (framework match)
          (framework helpers)
          ;; Load your passes:
          (compiler verify-scheme)
          (compiler generate-x86-64)
          )

(define (assemble thunk)
  (with-output-to-file "t.s"
    thunk 
    'replace)
  (unless (zero? (system "cc -m64 -o t t.s framework/runtime.c"))
    (error 'assemble "assembly failed"))
  "./t")

 (define-compiler (p423-compile p423-compile-passes source/wrapper)
   (verify-scheme verify-scheme/wrapper)
   (generate-x86-64 generate-x86-64/wrapper assemble))

) ;; End library

